import{r as a,j as e,U as j}from"./index-CdJXd1_c.js";import{u as S,a as M}from"./Index-BfFHxCUI.js";import"./supabase-DllM73rC.js";import"./Settings-Cpmykwza.js";function A({equipmentId:m,equipmentName:v,eventType:d,onClose:x,onSuccess:k}){const{createMovement:N,uploadPhoto:_}=S(),{user:u}=M(),[h,p]=a.useState(!1),[n,y]=a.useState({}),f=a.useRef(null),[r,i]=a.useState({assigned_to:"",site:"",job_reference:"",notes:"",expected_return_date:""}),[l,b]=a.useState(null),w=()=>{const t={};return d==="check_out"&&(r.assigned_to.trim()||(t.assigned_to="Assigned to is required for check-out"),r.site.trim()||(t.site="Site is required for check-out")),y(t),Object.keys(t).length===0},C=async t=>{if(t.preventDefault(),!!w()){p(!0);try{let s="";if(l){const L=`movements/${m}/${Date.now()}-${l.name}`,g=await _(l,L);g&&(s=g)}const c={equipment_id:m,event_type:d,event_timestamp:new Date().toISOString(),assigned_to:r.assigned_to,site:r.site,job_reference:r.job_reference,notes:r.notes,created_by:(u==null?void 0:u.email)||"system"};d==="check_out"?(c.expected_return_date=r.expected_return_date||null,s&&(c.pickup_photo_url=s)):s&&(c.return_photo_url=s),await N(c)&&k()}catch(s){console.error("Movement error:",s)}finally{p(!1)}}},o=d==="check_out";return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${j.card} w-full max-w-lg max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${j.divider} flex items-center justify-between ${o?"bg-blue-50":"bg-emerald-50"}`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-bold ${o?"text-blue-900":"text-emerald-900"}`,children:o?"Check Out Equipment":"Return Equipment"}),e.jsx("p",{className:"text-sm text-foreground/85 mt-0.5",children:v})]}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Assigned To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.assigned_to,onChange:t=>i(s=>({...s,assigned_to:t.target.value})),placeholder:"Person name",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2  ${n.assigned_to?"border-red-500/40 bg-red-500/10":"border-border/70"}`}),n.assigned_to&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:n.assigned_to})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Site ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.site,onChange:t=>i(s=>({...s,site:t.target.value})),placeholder:"Site name or location",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2  ${n.site?"border-red-500/40 bg-red-500/10":"border-border/70"}`}),n.site&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:n.site})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Job Reference"}),e.jsx("input",{type:"text",value:r.job_reference,onChange:t=>i(s=>({...s,job_reference:t.target.value})),placeholder:"e.g., JOB-2024-001",className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2 "})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Expected Return Date"}),e.jsx("input",{type:"date",value:r.expected_return_date,onChange:t=>i(s=>({...s,expected_return_date:t.target.value})),className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2 "})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Notes"}),e.jsx("textarea",{value:r.notes,onChange:t=>i(s=>({...s,notes:t.target.value})),rows:3,placeholder:"Add any relevant notes...",className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2  resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:o?"Pickup Photo":"Return Photo"}),e.jsx("div",{onClick:()=>{var t;return(t=f.current)==null?void 0:t.click()},className:"border-2 border-dashed border-border/70 rounded-lg p-4 text-center cursor-pointer hover:border-white/20 transition-colors",children:l?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-foreground/90",children:l.name}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),b(null)},className:"text-muted-foreground hover:text-red-500",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-8 h-8 text-white/20 mx-auto mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click to upload photo"})]})}),e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:t=>{var s;return b(((s=t.target.files)==null?void 0:s[0])||null)},className:"hidden"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 px-4 py-2.5 border border-border/70 rounded-lg text-sm font-medium text-foreground/90 hover:bg-white/5 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium text-white transition-colors disabled:opacity-50 ${o?"bg-primary hover:bg-primary text-primary-foreground font-semibold":"bg-emerald-600 hover:bg-emerald-700"}`,children:h?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Processing..."]}):o?"Confirm Check Out":"Confirm Return"})]})]})]})})}export{A as default};
