import{r as c,j as e}from"./index-7K_wa8a5.js";import{u as R,U as y}from"./Index-BpgDgaf8.js";import"./supabase-DllM73rC.js";function E({onClose:h,onSuccess:_}){const{createEquipment:k,equipment:C}=R(),j=c.useRef(null),[o,x]=c.useState("upload"),[m,g]=c.useState([]),[b,L]=c.useState(0),[p,M]=c.useState({success:0,failed:0}),I=new Set(C.map(t=>t.asset_id.toLowerCase())),q=t=>{const a=t.trim().split(`
`);if(a.length<2)return[];const n=a[0].split(",").map(l=>l.trim().toLowerCase().replace(/['"]/g,""));return a.slice(1).map(l=>{const r=l.split(",").map(f=>f.trim().replace(/^["']|["']$/g,"")),s={};n.forEach((f,B)=>{s[f]=r[B]||""});const i=[],d=s.asset_id||s["asset id"]||s.id||"",N=s.name||s["equipment name"]||s.equipment||"";d||i.push("Missing Asset ID"),N||i.push("Missing Name");const w=I.has(d.toLowerCase());return w&&i.push("Duplicate Asset ID"),{asset_id:d,name:N,category:s.category||s.type||"General",condition:s.condition||"Good",notes:s.notes||s.description||"",test_tag_done_date:s.test_tag_done_date||s.last_test||s["last test"]||"",test_tag_next_due:s.test_tag_next_due||s.next_test||s["next test"]||"",qr_code:s.qr_code||s.qr||"",isValid:i.length===0,errors:i,isDuplicate:w}})},S=t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];if(!a)return;const n=new FileReader;n.onload=r=>{var d;const s=(d=r.target)==null?void 0:d.result,i=q(s);g(i),x("preview")},n.readAsText(a)},V=async()=>{const t=m.filter(l=>l.isValid);if(t.length===0)return;x("importing");let a=0,n=0;for(let l=0;l<t.length;l++){const r=t[l];try{await k({asset_id:r.asset_id,qr_code:r.qr_code||`QR-${r.asset_id}`,name:r.name,category:r.category,condition:r.condition,notes:r.notes,test_tag_done_date:r.test_tag_done_date||null,test_tag_next_due:r.test_tag_next_due||null,current_status:"Available",tag_threshold_days:30})?a++:n++}catch{n++}L((l+1)/t.length*100)}M({success:a,failed:n}),x("done")},u=m.filter(t=>t.isValid).length,v=m.filter(t=>!t.isValid).length;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${y.card} w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${y.divider} flex items-center justify-between`,children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Import Equipment"}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[o==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{onClick:()=>{var t;return(t=j.current)==null?void 0:t.click()},className:"border-2 border-dashed border-white/20 rounded-xl p-12 text-center cursor-pointer hover:border- hover:bg-blue-50/30 transition-all",children:[e.jsx("svg",{className:"w-12 h-12 text-white/20 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),e.jsx("p",{className:"text-sm font-medium text-slate-200 mb-1",children:"Click to upload CSV file"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Supports .csv files"})]}),e.jsx("input",{ref:j,type:"file",accept:".csv,.txt",onChange:S,className:"hidden"}),e.jsxs("div",{className:"bg-slate-900/40 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Expected CSV Format"}),e.jsxs("code",{className:"text-xs text-slate-300 block bg-slate-900/40 p-3 rounded border border-white/10 font-mono",children:["asset_id,name,category,condition,notes,test_tag_done_date,test_tag_next_due",e.jsx("br",{}),"TT-0025,Makita Drill,Power Tools,Good,Heavy duty,2026-01-15,2026-07-15"]})]})]}),o==="preview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),u," valid"]}),v>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-50 text-red-700 rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),v," invalid"]})]}),e.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-64",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/40 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-slate-400",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-slate-400",children:"Asset ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-slate-400",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-slate-400",children:"Category"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-slate-400",children:"Issues"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:m.map((t,a)=>e.jsxs("tr",{className:t.isValid?"":"bg-red-50/50",children:[e.jsx("td",{className:"px-3 py-2",children:t.isValid?e.jsx("span",{className:"w-5 h-5 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}):e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-100 text-red-600 flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}),e.jsx("td",{className:"px-3 py-2 font-mono text-xs",children:t.asset_id||"-"}),e.jsx("td",{className:"px-3 py-2",children:t.name||"-"}),e.jsx("td",{className:"px-3 py-2 text-slate-400",children:t.category}),e.jsx("td",{className:"px-3 py-2 text-xs text-red-500",children:t.errors.join(", ")})]},a))})]})})})]}),o==="importing"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("svg",{className:"animate-spin w-12 h-12 text- mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-sm font-medium text-white mb-2",children:"Importing equipment..."}),e.jsx("div",{className:"w-64 mx-auto h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg- rounded-full transition-all",style:{width:`${b}%`}})}),e.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:[Math.round(b),"%"]})]}),o==="done"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-lg font-bold text-white mb-1",children:"Import Complete"}),e.jsxs("p",{className:"text-sm text-slate-400",children:[p.success," imported successfully",p.failed>0&&`, ${p.failed} failed`]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-white/10 flex items-center justify-end gap-3",children:[o==="upload"&&e.jsx("button",{onClick:h,className:"px-4 py-2.5 border border-white/10 rounded-lg text-sm font-medium text-slate-200 hover:bg-slate-900/40",children:"Cancel"}),o==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{x("upload"),g([])},className:"px-4 py-2.5 border border-white/10 rounded-lg text-sm font-medium text-slate-200 hover:bg-slate-900/40",children:"Back"}),e.jsxs("button",{onClick:V,disabled:u===0,className:"px-4 py-2.5 bg-amber-500/90 text-slate-950 rounded-lg text-sm font-semibold hover:bg-amber-500 disabled:opacity-50",children:["Import ",u," Items"]})]}),o==="done"&&e.jsx("button",{onClick:()=>{_(),h()},className:"px-4 py-2.5 bg-amber-500/90 text-slate-950 rounded-lg text-sm font-semibold hover:bg-amber-500",children:"Done"})]})]})})}export{E as default};
