import{r as a,j as e,U as N}from"./index-DKL_nJHR.js";import{u as M,b as P}from"./Index-BQvG75iH.js";import"./supabase-DllM73rC.js";import"./Settings-BNoUnTyS.js";const E=["New","Good","Fair","Poor","Damaged","Not Working"];function A({equipmentId:x,equipmentName:k,eventType:m,onClose:c,onSuccess:w}){const{createMovement:y,uploadPhoto:C,error:p}=M(),{user:u}=P(),[h,b]=a.useState(!1),[o,S]=a.useState({}),[g,f]=a.useState(null),j=a.useRef(null),n=m==="check_out",[r,i]=a.useState({assigned_to:"",site:"",job_reference:"",notes:"",expected_return_date:"",return_condition:"",has_new_issues:"",issue_description:"",service_repair:"none"}),[d,_]=a.useState(null),R=()=>{const s={};return n?(r.assigned_to.trim()||(s.assigned_to="Assigned to is required for check-out"),r.site.trim()||(s.site="Site is required for check-out")):(r.return_condition||(s.return_condition="Return condition is required"),r.has_new_issues||(s.has_new_issues="Please confirm if there are any new issues"),r.has_new_issues==="yes"&&(r.issue_description.trim()||(s.issue_description="Issue description is required"))),S(s),Object.keys(s).length===0},q=async s=>{if(s.preventDefault(),!!R()){f(null),b(!0);try{let t="";if(d){const L=`movements/${x}/${Date.now()}-${d.name}`,v=await C(d,L);v&&(t=v)}const l={equipment_id:x,event_type:m,event_timestamp:new Date().toISOString(),assigned_to:r.assigned_to,site:r.site,job_reference:r.job_reference,notes:r.notes,created_by:(u==null?void 0:u.email)||"system"};n?(l.expected_return_date=r.expected_return_date||null,t&&(l.pickup_photo_url=t)):(t&&(l.return_photo_url=t),l.return_condition=r.return_condition||null,l.has_new_issues=r.has_new_issues==="yes",l.issue_description=r.has_new_issues==="yes"&&r.issue_description||null,l.requires_service=r.service_repair==="service",l.requires_repair=r.service_repair==="repair"),await y(l)?(w(),c()):f(null)}catch(t){console.error("Movement error:",t)}finally{b(!1)}}},$=n?"Pickup Photo":r.has_new_issues==="yes"?"Issue Photo":"Return Photo";return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${N.card} w-full max-w-lg max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${N.divider} flex items-center justify-between ${n?"bg-blue-50":"bg-emerald-50"}`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-bold ${n?"text-blue-900":"text-emerald-900"}`,children:n?"Check Out Equipment":"Return Equipment"}),e.jsx("p",{className:"text-sm text-foreground/85 mt-0.5",children:k})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:q,className:"p-6 space-y-4",children:[(g||p)&&e.jsx("div",{className:"p-3 rounded-lg border border-destructive/30 bg-destructive/10 text-sm text-destructive",children:p||g}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Assigned To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.assigned_to,onChange:s=>i(t=>({...t,assigned_to:s.target.value})),placeholder:"Person name",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2  ${o.assigned_to?"border-red-500/40 bg-red-500/10":"border-border/70"}`}),o.assigned_to&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.assigned_to})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Site ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.site,onChange:s=>i(t=>({...t,site:s.target.value})),placeholder:"Site name or location",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2  ${o.site?"border-red-500/40 bg-red-500/10":"border-border/70"}`}),o.site&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.site})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Job Reference"}),e.jsx("input",{type:"text",value:r.job_reference,onChange:s=>i(t=>({...t,job_reference:s.target.value})),placeholder:"e.g., JOB-2024-001",className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2 "})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Expected Return Date"}),e.jsx("input",{type:"date",value:r.expected_return_date,onChange:s=>i(t=>({...t,expected_return_date:s.target.value})),className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2 "})]})]}),!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Return Condition ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.return_condition,onChange:s=>i(t=>({...t,return_condition:s.target.value})),className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2 ${o.return_condition?"border-red-500/40 bg-red-500/10":"border-border/70"}`,children:[e.jsx("option",{value:"",children:"Select condition..."}),E.map(s=>e.jsx("option",{value:s,children:s},s))]}),o.return_condition&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.return_condition})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Any new issues or damage? ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i(s=>({...s,has_new_issues:"no",issue_description:""})),className:`px-3 py-2 rounded-lg text-sm border transition-colors ${r.has_new_issues==="no"?"border-border/70 bg-background/40":"border-border/70 hover:bg-background/40"}`,children:"No"}),e.jsx("button",{type:"button",onClick:()=>i(s=>({...s,has_new_issues:"yes"})),className:`px-3 py-2 rounded-lg text-sm border transition-colors ${r.has_new_issues==="yes"?"border-border/70 bg-background/40":"border-border/70 hover:bg-background/40"}`,children:"Yes"})]}),o.has_new_issues&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.has_new_issues})]}),r.has_new_issues==="yes"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Issue Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r.issue_description,onChange:s=>i(t=>({...t,issue_description:s.target.value})),rows:3,placeholder:"Describe the issue/damage...",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2 resize-none ${o.issue_description?"border-red-500/40 bg-red-500/10":"border-border/70"}`}),o.issue_description&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.issue_description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Service / Repair Required"}),e.jsxs("select",{value:r.service_repair,onChange:s=>i(t=>({...t,service_repair:s.target.value})),className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2",children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"service",children:"Routine service required"}),e.jsx("option",{value:"repair",children:"Repair required"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selecting “Repair required” will flag the equipment for Repair status (next step)."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Notes"}),e.jsx("textarea",{value:r.notes,onChange:s=>i(t=>({...t,notes:s.target.value})),rows:3,placeholder:"Add any relevant notes...",className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2  resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:$}),e.jsx("div",{onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()},className:`border-2 border-dashed rounded-lg p-4 text-center cursor-pointer transition-colors ${o.return_photo?"border-red-500/40 bg-red-500/10":"border-border/70 hover:border-white/20"}`,children:d?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-foreground/90",children:d.name}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),_(null)},className:"text-muted-foreground hover:text-red-500",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-8 h-8 text-white/20 mx-auto mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click to upload photo"})]})}),o.return_photo&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.return_photo}),e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:s=>{var t;return _(((t=s.target.files)==null?void 0:t[0])||null)},className:"hidden"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:c,className:"flex-1 px-4 py-2.5 border border-border/70 rounded-lg text-sm font-medium text-foreground/90 hover:bg-white/5 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium text-white transition-colors disabled:opacity-50 ${n?"bg-primary hover:bg-primary text-primary-foreground font-semibold":"bg-emerald-600 hover:bg-emerald-700"}`,children:h?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Processing..."]}):n?"Confirm Check Out":"Confirm Return"})]})]})]})})}export{A as default};
