const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-DaGWoqK_.js","assets/index-D2wEAUMB.js","assets/index-B43g3EOD.css","assets/supabase-DllM73rC.js","assets/Settings-DvgwgW1l.js","assets/EquipmentList-BsGG5rrm.js","assets/StatusBadge-Dco8OKUD.js","assets/EquipmentDetail-CgD8HTmD.js","assets/EquipmentForm-BJyZ0kSJ.js","assets/MovementForm-D5rCCTfN.js","assets/ImportModal-D4R87v9m.js","assets/AuthModal-ChzrSLYu.js"])))=>i.map(i=>d[i]);
import{r as t,j as e,U as P,_ as M}from"./index-D2wEAUMB.js";import{s as g}from"./supabase-DllM73rC.js";import Y from"./Settings-DvgwgW1l.js";const F=t.createContext(null);async function Z(a){const{data:i,error:o}=await g.from("profiles").select("*").eq("user_id",a).maybeSingle();if(o)throw o;return i??null}function ee({children:a}){const[i,o]=t.useState({user:null,isAuthenticated:!1,isAdmin:!1,isLoading:!0,error:null}),d=t.useRef(null),l=t.useRef(null),f=t.useRef(!0),b=t.useCallback(()=>{d.current=null,l.current=null,f.current&&o({user:null,isAuthenticated:!1,isAdmin:!1,isLoading:!1,error:null})},[]),w=t.useCallback(m=>{f.current&&o({user:m,isAuthenticated:!0,isAdmin:m.role==="admin",isLoading:!1,error:null})},[]),h=t.useCallback(async m=>{if(d.current===m&&l.current)return l.current;d.current=m;const v=(async()=>{try{return await Z(m)}catch(u){return console.error("Profile fetch error:",u),null}})();return l.current=v,v},[]);t.useEffect(()=>{f.current=!0;const m=async u=>{var S,C;if(!((S=u==null?void 0:u.user)!=null&&S.id)){b();return}if(!f.current)return;o(k=>({...k,isLoading:!0,error:null}));const p=u.user.id,y=await h(p);f.current&&d.current===p&&w(y||{id:p,user_id:p,email:u.user.email||"",full_name:((C=u.user.user_metadata)==null?void 0:C.full_name)||u.user.email||"",role:"standard",created_at:new Date().toISOString()})};g.auth.getSession().then(({data:u})=>{m(u.session)});const{data:{subscription:v}}=g.auth.onAuthStateChange((u,p)=>{m(p)});return()=>{f.current=!1,v.unsubscribe()}},[h,w,b]);const c=t.useCallback(async(m,v)=>{o(p=>({...p,isLoading:!0,error:null}));const{error:u}=await g.auth.signInWithPassword({email:m,password:v});u&&o(p=>({...p,isLoading:!1,error:u.message}))},[]),L=t.useCallback(async(m,v,u,p="standard")=>{var C;o(k=>({...k,isLoading:!0,error:null}));const{data:y,error:S}=await g.auth.signUp({email:m,password:v,options:{data:{full_name:u}}});if(S){o(k=>({...k,isLoading:!1,error:S.message}));return}(C=y.user)!=null&&C.id&&await g.from("profiles").upsert({user_id:y.user.id,email:m,full_name:u,role:p})},[]),j=t.useCallback(async()=>{await g.auth.signOut()},[]),A=t.useCallback(()=>{o(m=>({...m,error:null}))},[]);return e.jsx(F.Provider,{value:{...i,signIn:c,signUp:L,signOut:j,clearError:A},children:a})}function $(){const a=t.useContext(F);if(!a)throw new Error("useAuth must be used within AuthProvider");return a}function te(a){if(!a.test_tag_next_due)return"No Tag";const i=new Date,o=new Date(a.test_tag_next_due),d=Math.ceil((o.getTime()-i.getTime())/(1e3*60*60*24));return d<0?"Expired":d<=a.tag_threshold_days?"Due Soon":"OK"}function se(a){return a==="Maintenance"?"Repair":a}function re(a){const i=se(a.current_status);if(i==="Repair"||i==="Expired"||i==="Overdue")return i;if(i==="In Use"){if(a.expected_return_date){const o=new Date;if(new Date(a.expected_return_date)<o)return"Overdue"}return"In Use"}return"Available"}const ye=["Power Tools","Survey Equipment","Compaction","Power Supply","Cutting Equipment","Fastening Tools","Demolition","Electrical Testing","Access Equipment","General","Safety Equipment","Hand Tools"],W=t.createContext(null);function D(a,i){const o=a.toLowerCase(),d=i.toLowerCase();if(o.includes(d))return!0;let l=0;for(let f=0;f<o.length&&l<d.length;f++)o[f]===d[l]&&l++;return l===d.length}function ne({children:a}){const[i,o]=t.useState([]),[d,l]=t.useState([]),[f,b]=t.useState(!0),[w,h]=t.useState(null),[c,L]=t.useState(""),[j,A]=t.useState("All"),[m,v]=t.useState(null),u=t.useCallback(async()=>{b(!0),h(null);const s=new AbortController,r=setTimeout(()=>s.abort(),12e3);try{const[n,x]=await Promise.all([g.from("equipment").select("*").order("asset_id",{ascending:!0}).abortSignal(s.signal),g.from("movements").select("*").order("event_timestamp",{ascending:!1}).abortSignal(s.signal)]);if(clearTimeout(r),n.error)throw n.error;if(x.error)throw x.error;const T=(n.data||[]).map(I=>{const O=re(I),V=te(I);return{...I,current_status:O,_derived_status:O,_derived_tag:V}});o(T),l(x.data||[])}catch(n){n.name==="AbortError"?h("Request timed out. Please try again."):h(n.message||"Failed to load data")}finally{b(!1)}},[]);t.useEffect(()=>{u()},[u]);const p=t.useMemo(()=>{const s={total:0,available:0,inUse:0,overdue:0,repair:0,expiredTags:0,dueSoon:0};return i.forEach(r=>{s.total++;const n=r._derived_status;n==="Available"&&s.available++,n==="In Use"&&s.inUse++,n==="Overdue"&&s.overdue++,n==="Repair"&&s.repair++;const x=r._derived_tag;x==="Expired"&&s.expiredTags++,x==="Due Soon"&&s.dueSoon++}),s},[i]),y=t.useMemo(()=>{let s=i;switch(j){case"Available":s=s.filter(r=>r._derived_status==="Available");break;case"In Use":s=s.filter(r=>r._derived_status==="In Use");break;case"Overdue":s=s.filter(r=>r._derived_status==="Overdue");break;case"Repair":case"Maintenance":s=s.filter(r=>r._derived_status==="Repair");break;case"Expired Tags":s=s.filter(r=>r._derived_tag==="Expired");break;case"Due Soon":s=s.filter(r=>r._derived_tag==="Due Soon");break}return c.trim()&&(s=s.filter(r=>D(r.name,c)||D(r.asset_id,c)||D(r.category,c)||D(r.assigned_to||"",c)||D(r.assigned_site||"",c))),s},[i,j,c]),S=t.useMemo(()=>m&&i.find(s=>s.id===m)||null,[m,i]),C=t.useMemo(()=>m?d.filter(s=>s.equipment_id===m):[],[m,d]),k=t.useCallback(s=>{v(s)},[]),N=t.useCallback(async s=>{try{const{data:r,error:n}=await g.from("equipment").insert(s).select().single();if(n)throw n;return await u(),r}catch(r){return console.error("[createEquipment] failed",r),h((r==null?void 0:r.message)||"Create failed"),null}},[u]),q=t.useCallback(async(s,r)=>{try{const{error:n}=await g.from("equipment").update({...r,updated_at:new Date().toISOString()}).eq("id",s);if(n)throw n;return await u(),!0}catch(n){return h(n.message),!1}},[u]),R=t.useCallback(async s=>{try{const{error:r}=await g.from("movements").insert(s);if(r)throw r;const n={};if(s.event_type==="check_out")n.current_status="In Use",n.assigned_to=s.assigned_to||"",n.assigned_site=s.site||"",n.assigned_job=s.job_reference||"",n.expected_return_date=s.expected_return_date||null;else if(s.event_type==="return"){const x=!!s.requires_service,T=!!s.requires_repair;n.current_status=x||T?"Maintenance":"Available",n.assigned_to="",n.assigned_site="",n.assigned_job="",n.expected_return_date=null}if(s.equipment_id){const{error:x}=await g.from("equipment").update({...n,updated_at:new Date().toISOString()}).eq("id",s.equipment_id);if(x)throw x}return await u(),!0}catch(r){return h(r.message),!1}},[u]),U=t.useCallback(async(s,r)=>{try{const{error:n}=await g.storage.from("equipment-photos").upload(r,s,{upsert:!0});if(n)throw n;const{data:x}=g.storage.from("equipment-photos").getPublicUrl(r);return x.publicUrl}catch(n){return console.error("[createEquipment] failed",n),h((n==null?void 0:n.message)||"Create failed"),null}},[]);return e.jsx(W.Provider,{value:{equipment:i,movements:d,isLoading:f,error:w,searchQuery:c,activeFilter:j,filteredEquipment:y,stats:p,selectedEquipment:S,selectedMovements:C,setSearchQuery:L,setActiveFilter:A,selectEquipment:k,refreshData:u,createEquipment:N,updateEquipment:q,createMovement:R,uploadPhoto:U},children:a})}function H(){const a=t.useContext(W);if(!a)throw new Error("useEquipment must be used within EquipmentProvider");return a}function ae({onOpenAuth:a,currentView:i,onScanResult:o,onToggleSidebar:d}){var j;const{user:l,isAdmin:f,setDemoRole:b,signOut:w}=$(),[h,c]=t.useState(!1),L={dashboard:"Dashboard",equipment:"Equipment Registry",detail:"Equipment Detail"};return e.jsx("header",{className:"sticky top-0 z-20 llt-nav-shell",children:e.jsxs("div",{className:"px-4 lg:px-6 h-16 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{type:"button","aria-label":"Open menu",onClick:()=>d==null?void 0:d(),className:"lg:hidden inline-flex items-center justify-center rounded-lg border border-input llt-surface-2 p-2 text-foreground/80 llt-nav-item",children:e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("h1",{className:"text-lg font-semibold truncate",children:L[i]||"Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{type:"button",className:"hidden sm:inline-flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-semibold bg-primary text-primary-foreground hover:opacity-95 transition-opacity",onClick:()=>{},children:"Scan QR"}),e.jsxs("div",{className:"hidden md:flex items-center rounded-lg p-0.5 border border-input bg-card/60",children:[e.jsx("button",{type:"button",onClick:()=>b("admin"),className:`px-2.5 py-1 rounded-md text-xs font-medium transition-colors ${f?"bg-accent text-accent-foreground":"text-muted-foreground hover:text-foreground"}`,children:"Admin"}),e.jsx("button",{type:"button",onClick:()=>b("standard"),className:`px-2.5 py-1 rounded-md text-xs font-medium transition-colors ${f?"text-muted-foreground hover:text-foreground":"bg-accent text-accent-foreground"}`,children:"Standard"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>c(A=>!A),className:"flex items-center gap-2 rounded-lg px-2 py-1.5 llt-nav-item",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent text-accent-foreground flex items-center justify-center text-sm font-semibold",children:((j=l==null?void 0:l.full_name)==null?void 0:j.charAt(0))||"U"}),e.jsx("span",{className:"hidden lg:block text-sm text-muted-foreground",children:(l==null?void 0:l.full_name)||"User"})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>c(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 z-40 overflow-hidden rounded-xl border border-border/60 llt-overlay-panel text-popover-foreground ",children:[e.jsxs("div",{className:`px-4 py-3 border-b ${P.divider}`,children:[e.jsx("p",{className:"text-sm font-medium",children:l==null?void 0:l.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l==null?void 0:l.email})]}),e.jsx("button",{type:"button",onClick:()=>{a(),c(!1)},className:"w-full text-left px-4 py-2 text-sm llt-nav-item",children:"Account"}),e.jsx("button",{type:"button",onClick:()=>{w(),c(!1)},className:"w-full text-left px-4 py-2 text-sm text-destructive hover:bg-accent transition-colors",children:"Sign Out"})]})]})]})]})]})})}function oe({currentView:a,onNavigate:i,collapsed:o,onToggle:d}){const{stats:l}=H(),f="/long-line-tracker-v2/LLT-developer-logo.png",b=[{id:"dashboard",label:"Dashboard",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"})})},{id:"equipment",label:"Equipment",badge:l.total,icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17l-5.384-3.19A2.625 2.625 0 015.25 9.75V6.375a2.625 2.625 0 012.786-2.619l5.384.319M11.42 15.17l5.384 3.19A2.625 2.625 0 0017.25 16.5V6.375a2.625 2.625 0 00-2.786-2.619l-5.384.319M11.42 15.17V20.25"})})},,{id:"settings",label:"Settings",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.983 5.25c.425-1.06 1.608-1.06 2.033 0l.314.783a1.125 1.125 0 001.1.72h.823c1.14 0 1.616 1.454.708 2.121l-.666.49a1.125 1.125 0 00-.41 1.257l.254.83c.338 1.104-.9 2.02-1.847 1.364l-.686-.5a1.125 1.125 0 00-1.32 0l-.686.5c-.947.656-2.185-.26-1.847-1.364l.254-.83a1.125 1.125 0 00-.41-1.257l-.666-.49c-.908-.667-.432-2.12.708-2.12h.823a1.125 1.125 0 001.1-.72l.314-.784z"})})}],w=[{label:"Overdue",count:l.overdue,dot:"bg-destructive"},{label:"Expired Tags",count:l.expiredTags,dot:"bg-destructive"},{label:"Due Soon",count:l.dueSoon,dot:"bg-primary"},,{id:"settings",label:"Settings",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.983 5.25c.425-1.06 1.608-1.06 2.033 0l.314.783a1.125 1.125 0 001.1.72h.823c1.14 0 1.616 1.454.708 2.121l-.666.49a1.125 1.125 0 00-.41 1.257l.254.83c.338 1.104-.9 2.02-1.847 1.364l-.686-.5a1.125 1.125 0 00-1.32 0l-.686.5c-.947.656-2.185-.26-1.847-1.364l.254-.83a1.125 1.125 0 00-.41-1.257l-.666-.49c-.908-.667-.432-2.12.708-2.12h.823a1.125 1.125 0 001.1-.72l.314-.784z"})})}],h=c=>a===c||c==="equipment"&&a==="detail";return e.jsxs("aside",{className:[o?"w-16":"w-64","h-screen flex flex-col transition-[width] duration-300","bg-sidebar text-sidebar-foreground border-r border-sidebar-border/70"].join(" "),children:[e.jsxs("div",{className:"h-16 flex items-center gap-3 px-4 border-b border-sidebar-border/70",children:[e.jsx("img",{src:f,alt:"Long Line Tracker",className:"w-10 h-10 object-contain",draggable:!1}),!o&&e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold leading-tight",children:"Long Line"}),e.jsx("div",{className:"text-[10px] text-sidebar-foreground/60 font-medium tracking-wider uppercase",children:"Tracker v2"})]})]}),e.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1 overflow-y-auto",children:b.map(c=>e.jsxs("button",{onClick:()=>i(c.id),title:o?c.label:void 0,className:["w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-colors",h(c.id)?"bg-sidebar-accent text-sidebar-accent-foreground ring-1 ring-sidebar-ring/25":"text-sidebar-foreground/80 hover:text-sidebar-foreground hover:bg-sidebar-accent/60"].join(" "),children:[e.jsx("span",{className:"shrink-0",children:c.icon}),!o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 text-left truncate",children:c.label}),typeof c.badge=="number"&&e.jsx("span",{className:"bg-sidebar-accent text-sidebar-accent-foreground text-xs px-2 py-0.5 rounded-full",children:c.badge})]})]},c.id))}),!o&&e.jsx("div",{className:"px-3 pb-4",children:e.jsxs("div",{className:`${P.card} p-3`,children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wider mb-2",children:"Alerts"}),e.jsx("div",{className:"space-y-2",children:w.map(c=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-foreground/80",children:c.label}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${c.dot}`}),e.jsx("span",{className:"text-xs font-semibold tabular-nums",children:c.count})]})]},c.label))})]})}),e.jsx("button",{onClick:d,className:"h-12 flex items-center justify-center border-t border-sidebar-border/70 text-sidebar-foreground/80 hover:text-sidebar-foreground hover:bg-sidebar-accent/60 transition-colors",title:o?"Expand":"Collapse",type:"button",children:e.jsx("svg",{className:`w-5 h-5 transition-transform ${o?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.75 19.5l-7.5-7.5 7.5-7.5m-6 15L5.25 12l7.5-7.5"})})})]})}function ie({message:a,type:i,onClose:o,duration:d=4e3}){t.useEffect(()=>{const b=setTimeout(o,d);return()=>clearTimeout(b)},[o,d]);const l={success:"bg-emerald-600",error:"bg-red-600",info:"bg-slate-800/70 backdrop-blur-md"},f={success:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),error:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),info:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})};return e.jsx("div",{className:"fixed top-4 right-4 z-[100] animate-slide-in",children:e.jsxs("div",{className:`${l[i]} text-white rounded-xl shadow-lg px-4 py-3 flex items-center gap-3 min-w-[300px]`,children:[f[i],e.jsx("p",{className:"text-sm font-medium flex-1",children:a}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})})}const le=t.lazy(()=>M(()=>import("./Dashboard-DaGWoqK_.js"),__vite__mapDeps([0,1,2,3,4]))),ce=t.lazy(()=>M(()=>import("./EquipmentList-BsGG5rrm.js"),__vite__mapDeps([5,1,2,6,3,4]))),ue=t.lazy(()=>M(()=>import("./EquipmentDetail-CgD8HTmD.js"),__vite__mapDeps([7,1,2,6,3,4]))),de=t.lazy(()=>M(()=>import("./EquipmentForm-BJyZ0kSJ.js"),__vite__mapDeps([8,1,2,3,4]))),me=t.lazy(()=>M(()=>import("./MovementForm-D5rCCTfN.js"),__vite__mapDeps([9,1,2,3,4]))),fe=t.lazy(()=>M(()=>import("./ImportModal-D4R87v9m.js"),__vite__mapDeps([10,1,2,3,4]))),pe=t.lazy(()=>M(()=>import("./AuthModal-ChzrSLYu.js"),__vite__mapDeps([11,1,2,3,4])));function he(){const[a,i]=t.useState("dashboard"),[o,d]=t.useState(!1),[l,f]=t.useState(!1),[b,w]=t.useState(),[h,c]=t.useState(!1),[L,j]=t.useState(!1),[A,m]=t.useState(!1),[v,u]=t.useState(!1),[p,y]=t.useState(null),[S,C]=t.useState(null),{selectedEquipment:k,selectEquipment:N,refreshData:q,equipment:R}=H(),{isAuthenticated:U,isLoading:s}=$(),r=t.useCallback((_,E="success")=>{C({message:_,type:E})},[]),n=t.useCallback((_,E)=>{i(_),w(E||void 0),f(!1)},[]),x=t.useCallback(_=>{N(_),i("detail"),f(!1)},[N]),T=t.useCallback(()=>{N(null),i("equipment")},[N]),I=t.useCallback(()=>{u(!1),j(!0)},[]),O=t.useCallback(()=>{u(!0),j(!0)},[]),V=t.useCallback(_=>{y(_)},[]),Q=t.useCallback(()=>{j(!1),r(v?"Equipment updated successfully":"Equipment created successfully"),q()},[v,r,q]),G=t.useCallback(()=>{m(!1),r("Equipment imported successfully"),q()},[r,q]),K=t.useCallback(()=>{y(null),r("Movement recorded successfully"),q()},[r,q]),J=t.useCallback(_=>{const E=(_||"").trim();if(!E)return;const B=R.find(z=>z.qr_code&&z.qr_code.toLowerCase()===E.toLowerCase()||z.asset_id&&z.asset_id.toLowerCase()===E.toLowerCase());B?(N(B.id),i("detail"),r("Navigated to  ()","success"),f(!1)):r(`No equipment found for QR code: ${E}`,"error")},[R,N,r]);if(s)return e.jsx("div",{className:`min-h-screen flex items-center justify-center text-slate-300 ${P.shell}`,children:"Loadingâ€¦"});if(!U)return e.jsx("div",{className:`min-h-screen flex items-center justify-center ${P.shell}`,children:e.jsx(t.Suspense,{fallback:null,children:e.jsx(pe,{onClose:()=>{}})})});const X=e.jsx("div",{className:"text-slate-400",children:"Loading..."});return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"hidden md:flex min-h-screen",children:[e.jsx(oe,{currentView:a,onNavigate:n,collapsed:o,onToggle:()=>d(_=>!_)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ae,{onOpenAuth:()=>c(!0),currentView:a,onScanResult:J,onToggleSidebar:()=>f(_=>!_)}),e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs(t.Suspense,{fallback:X,children:[a==="dashboard"&&e.jsx(le,{onNavigate:n}),a==="equipment"&&e.jsx(ce,{onSelectEquipment:x,onCreateNew:I,onImport:()=>m(!0),initialFilter:b}),a==="detail"&&e.jsx(ue,{onBack:T,onEdit:O,onMovement:V}),a==="settings"&&e.jsx(Y,{})]})})]})]}),e.jsxs(t.Suspense,{fallback:null,children:[L&&e.jsx(de,{equipment:v?k:null,onClose:()=>j(!1),onSuccess:Q}),p&&k&&e.jsx(me,{equipmentId:k.id,equipmentName:k.name,eventType:p,onClose:()=>y(null),onSuccess:K}),A&&e.jsx(fe,{onClose:()=>m(!1),onSuccess:G})]}),S&&e.jsx(ie,{message:S.message,type:S.type,onClose:()=>C(null)})]})}function xe(){return e.jsx(ee,{children:e.jsx(ne,{children:e.jsx(he,{})})})}const ge={sidebarOpen:!1,toggleSidebar:()=>{}},be=t.createContext(ge),ve=({children:a})=>{const[i,o]=t.useState(!1),d=()=>{o(l=>!l)};return e.jsx(be.Provider,{value:{sidebarOpen:i,toggleSidebar:d},children:a})},je=()=>e.jsx(ve,{children:e.jsx(xe,{})}),Se=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{ye as C,Se as I,te as a,$ as b,re as c,se as n,H as u};
