import{r as i,j as e}from"./index-7K_wa8a5.js";import{u as N,U as l,C as v}from"./Index-BpgDgaf8.js";import"./supabase-DllM73rC.js";const w=["New","Good","Fair","Poor","Damaged"];function $({equipment:r,onClose:m,onSuccess:x}){const{createEquipment:p,updateEquipment:_}=N(),[u,g]=i.useState(!1),[o,f]=i.useState({}),[h,c]=i.useState(null),d=!!r,[s,n]=i.useState({asset_id:"",name:"",category:"General",condition:"Good",notes:"",test_tag_done_date:"",test_tag_next_due:"",tag_threshold_days:30});i.useEffect(()=>{r&&n({asset_id:r.asset_id,name:r.name,category:r.category,condition:r.condition,notes:r.notes||"",test_tag_done_date:r.test_tag_done_date||"",test_tag_next_due:r.test_tag_next_due_date||r.test_tag_next_due||"",tag_threshold_days:r.tag_threshold_days??30})},[r]);const y=()=>{const t={};return s.asset_id.trim()||(t.asset_id="Asset ID is required"),s.name.trim()||(t.name="Name is required"),s.category||(t.category="Category is required"),f(t),Object.keys(t).length===0},j=async t=>{if(t.preventDefault(),c(null),!!y()){g(!0);try{if(d&&r){const a={asset_id:s.asset_id,name:s.name,category:s.category,condition:s.condition,test_tag_done_date:s.test_tag_done_date||null,test_tag_next_due_date:s.test_tag_next_due||null};await _(r.id,a)?x():c("Update failed. Check console/network and try again.")}else{const a=`QR-${s.asset_id}`,b={asset_id:s.asset_id,name:s.name,category:s.category,condition:s.condition,qr_code:a,test_tag_done_date:s.test_tag_done_date||null,test_tag_next_due_date:s.test_tag_next_due||null,current_status:"Available"};await p(b)?x():c("Create failed. Check console/network and try again.")}}catch(a){console.error("Equipment form error:",a),c((a==null?void 0:a.message)||"Unexpected error creating/updating equipment.")}finally{g(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${l.card} w-full max-w-lg max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${l.divider} flex items-center justify-between`,children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:d?"Edit Equipment":"Add New Equipment"}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[h&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:h}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:["Asset ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.asset_id,onChange:t=>n(a=>({...a,asset_id:t.target.value})),placeholder:"e.g., TT-0025",disabled:d,className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border- ${o.asset_id?"border-red-500/40 bg-red-500/10":"border-white/10"} ${d?"bg-slate-900/40 text-slate-400":""}`}),o.asset_id&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.asset_id})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:s.category,onChange:t=>n(a=>({...a,category:t.target.value})),className:`w-full px-3 py-2.5 rounded-lg text-sm focus:outline-none border ${l.input}`,children:v.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:["Equipment Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.name,onChange:t=>n(a=>({...a,name:t.target.value})),placeholder:"e.g., Hilti TE 70-ATC Rotary Hammer",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border- ${o.name?"border-red-500/40 bg-red-500/10":"border-white/10"}`}),o.name&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:o.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:"Condition"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:w.map(t=>e.jsx("button",{type:"button",onClick:()=>n(a=>({...a,condition:t})),className:`px-3 py-1.5 rounded-lg text-xs font-medium border transition-all ${s.condition===t?"bg-amber-500/15 text-amber-200 ring-1 ring-amber-400/20 border-transparent":"border-white/10 text-slate-300 hover:border-white/20"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:"Notes (local only for now)"}),e.jsx("textarea",{value:s.notes,onChange:t=>n(a=>({...a,notes:t.target.value})),rows:2,placeholder:"Equipment description or notes...",className:"w-full px-3 py-2.5 border border-white/10 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border- resize-none"})]}),e.jsxs("div",{className:`border-t ${l.divider} pt-4`,children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Test & Tag Compliance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:"Last Test Date"}),e.jsx("input",{type:"date",value:s.test_tag_done_date,onChange:t=>n(a=>({...a,test_tag_done_date:t.target.value})),className:`w-full px-3 py-2.5 rounded-lg text-sm focus:outline-none border ${l.input}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:"Next Due Date"}),e.jsx("input",{type:"date",value:s.test_tag_next_due,onChange:t=>n(a=>({...a,test_tag_next_due:t.target.value})),className:`w-full px-3 py-2.5 rounded-lg text-sm focus:outline-none border ${l.input}`})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-200 mb-1",children:"Due Soon Threshold (days) (local only for now)"}),e.jsx("input",{type:"number",value:s.tag_threshold_days,onChange:t=>n(a=>({...a,tag_threshold_days:parseInt(t.target.value)||30})),min:1,max:365,className:"w-32 px-3 py-2.5 border border-white/10 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 border border-white/10 rounded-lg text-sm font-medium text-slate-200 hover:bg-slate-900/40 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2.5 bg-amber-500/90 text-slate-950 rounded-lg text-sm font-semibold hover:bg-amber-500 transition-colors disabled:opacity-50",children:u?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Saving..."]}):d?"Update Equipment":"Create Equipment"})]})]})]})})}export{$ as default};
