import{r as w,j as e,U as r}from"./index-v9tK2_kz.js";import{u as k,a as y,b as _,c as L}from"./Index-BBg3jJQY.js";import{S as C,T as u,C as M}from"./StatusBadge-BoK8hZo1.js";import"./supabase-DllM73rC.js";import"./Settings-CibPhshl.js";function R({onBack:p,onEdit:g,onMovement:j}){const{selectedEquipment:t,selectedMovements:c}=k(),{isAdmin:x}=y(),[l,f]=w.useState(!1);if(!t)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-muted-foreground",children:"Equipment not found"})});const n=_(t),a=L(t),o=t.test_tag_next_due_date??t.test_tag_next_due??null,d=o?Math.ceil((new Date(o).getTime()-new Date().getTime())/(1e3*60*60*24)):null,m=t.qr_code,v=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(m)}&color=1e3a5f&bgcolor=ffffff&margin=8`,h=`https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=${encodeURIComponent(m)}&color=1e3a5f&bgcolor=ffffff&margin=16`,b=x&&(n==="Available"||n==="In Use"||n==="Overdue"),i=n==="Available",N=i?"Check Out":"Return";return e.jsxs("div",{className:"h-full overflow-y-auto overflow-x-hidden",children:[e.jsx("div",{className:`px-4 sm:px-6 py-3 sm:py-4 ${r.card} ${r.cardPad}`,children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 min-w-0",children:[e.jsx("button",{onClick:p,className:"p-2 hover:bg-background/40 rounded-lg transition-colors text-muted-foreground hover:text-foreground/85 shrink-0","aria-label":"Back",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs font-mono text-muted-foreground bg-background/40 px-2 py-0.5 rounded",children:t.asset_id}),e.jsx(C,{status:n}),e.jsx(u,{state:a})]}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white mt-1 truncate",children:t.name})]})]}),e.jsxs("div",{className:"w-full sm:w-auto flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end sm:gap-2",children:[b&&e.jsxs("button",{onClick:()=>j(i?"check_out":"return"),className:`w-full sm:w-auto px-4 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 ${i?"bg-primary text-primary-foreground hover:bg-primary":"bg-emerald-600 text-white hover:bg-emerald-700"}`,children:[i?e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 4.5l-15 15m0 0h11.25m-11.25 0V8.25"})}),N]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>f(!l),className:`flex-1 sm:flex-none p-2.5 border rounded-lg transition-colors ${l?"bg-primary text-primary-foreground border-ring/40":"border-border/70 text-foreground/85 hover:bg-background/40"}`,title:"Show QR Code","aria-label":"Show QR Code",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 013.75 9.375v-4.5zM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 01-1.125-1.125v-4.5zM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0113.5 9.375v-4.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 6.75h.75v.75h-.75v-.75zM6.75 16.5h.75v.75h-.75v-.75zM16.5 6.75h.75v.75h-.75v-.75zM13.5 13.5h.75v.75h-.75v-.75zM13.5 19.5h.75v.75h-.75v-.75zM19.5 13.5h.75v.75h-.75v-.75zM19.5 19.5h.75v.75h-.75v-.75zM16.5 16.5h.75v.75h-.75v-.75z"})]})}),x&&e.jsxs("button",{onClick:g,className:"flex-1 sm:flex-none px-4 py-2.5 border border-border/70 rounded-lg text-sm font-medium text-foreground/90 hover:bg-background/40 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})}),"Edit"]})]})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[l&&e.jsx("div",{className:`${r.card} ${r.cardPad}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsx("div",{className:"bg-background/40 p-3 rounded-2xl ring-1 ring-border/70",children:e.jsx("img",{src:v,alt:`QR Code for ${t.asset_id}`,width:200,height:200,className:"block"})}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-1",children:"Equipment QR Code"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Scan this code to quickly access this equipment's detail page."}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground bg-background/40 inline-block px-2 py-1 rounded mb-4",children:t.qr_code}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center sm:justify-start",children:[e.jsxs("a",{href:h,download:`${t.asset_id}-qr.png`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 px-3 py-2 bg-primary text-primary-foreground rounded-lg text-xs font-medium hover:bg-primary transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})}),"Download PNG"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(t.qr_code)},className:"inline-flex items-center gap-1.5 px-3 py-2 border border-border/70 rounded-lg text-xs font-medium text-foreground/90 hover:bg-background/40 transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9.75a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})}),"Copy Code"]}),e.jsxs("button",{onClick:()=>{const s=window.open("","_blank","width=400,height=500");s&&(s.document.write(`
                          <html><head><title>QR - ${t.asset_id}</title>
                          <style>body{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;margin:0}
                          img{margin-bottom:16px}h2{margin:0;font-size:18px}p{margin:4px 0;color:#666;font-size:13px}</style></head>
                          <body><img src="${h}" width="250" height="250"/>
                          <h2>${t.asset_id}</h2><p>${t.name}</p>
                          <script>setTimeout(()=>{window.print();},500)<\/script></body></html>
                        `),s.document.close())},className:"inline-flex items-center gap-1.5 px-3 py-2 border border-border/70 rounded-lg text-xs font-medium text-foreground/90 hover:bg-background/40 transition-colors",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z"})}),"Print Label"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:`${r.card} p-5`,children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-4",children:"Equipment Details"}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Category"}),e.jsx("dd",{className:"text-sm text-white mt-0.5",children:t.category})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Condition"}),e.jsx("dd",{className:"mt-0.5",children:e.jsx(M,{condition:t.condition})})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"QR Code"}),e.jsx("dd",{className:"text-sm text-white font-mono mt-0.5",children:t.qr_code})]}),t.notes&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Notes"}),e.jsx("dd",{className:"text-sm text-foreground/85 mt-0.5",children:t.notes})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Created"}),e.jsx("dd",{className:"text-sm text-foreground/85 mt-0.5",children:new Date(t.created_at).toLocaleDateString("en-AU",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),e.jsxs("div",{className:`${r.card} p-5`,children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-4",children:"Test & Tag Compliance"}),e.jsx("div",{className:`p-4 rounded-lg mb-4 ${a==="OK"?"bg-emerald-50":a==="Due Soon"?"bg-amber-50":a==="Expired"?"bg-red-500/10 ring-1 ring-red-500/20":"bg-background/40 ring-1 ring-border/70"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{state:a}),d!==null&&e.jsx("span",{className:`text-sm font-bold ${d<0?"text-red-600":d<=30?"text-amber-600":"text-emerald-600"}`,children:d<0?`${Math.abs(d)}d overdue`:`${d}d remaining`})]})}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Last Test"}),e.jsx("dd",{className:"text-sm text-white mt-0.5",children:t.test_tag_done_date?new Date(t.test_tag_done_date).toLocaleDateString("en-AU",{day:"numeric",month:"long",year:"numeric"}):"Not recorded"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Next Due"}),e.jsx("dd",{className:"text-sm text-white mt-0.5",children:o?new Date(o).toLocaleDateString("en-AU",{day:"numeric",month:"long",year:"numeric"}):"Not scheduled"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Threshold"}),e.jsxs("dd",{className:"text-sm text-foreground/85 mt-0.5",children:[t.tag_threshold_days," days"]})]})]})]}),(n==="In Use"||n==="Overdue")&&e.jsxs("div",{className:`${r.card} p-5`,children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-4",children:"Current Assignment"}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Assigned To"}),e.jsx("dd",{className:"text-sm text-white font-medium mt-0.5",children:t.assigned_to})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Site"}),e.jsx("dd",{className:"text-sm text-white mt-0.5",children:t.assigned_site})]}),t.assigned_job&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Job Reference"}),e.jsx("dd",{className:"text-sm text-white font-mono mt-0.5",children:t.assigned_job})]}),t.expected_return_date&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Expected Return"}),e.jsxs("dd",{className:`text-sm font-medium mt-0.5 ${new Date(t.expected_return_date)<new Date?"text-red-600":"text-white"}`,children:[new Date(t.expected_return_date).toLocaleDateString("en-AU",{day:"numeric",month:"long",year:"numeric"}),new Date(t.expected_return_date)<new Date&&" (OVERDUE)"]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:`${r.card}`,children:[e.jsxs("div",{className:`px-5 py-4 border-b ${r.divider} flex items-center justify-between`,children:[e.jsx("h3",{className:"font-semibold text-white",children:"Movement History"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[c.length," entries"]})]}),c.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-sm",children:"No movement history recorded"})]}):e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-px bg-white/10"}),e.jsx("div",{className:"space-y-6",children:c.map(s=>e.jsxs("div",{className:"relative pl-10",children:[e.jsx("div",{className:`absolute left-2 top-1 w-4 h-4 rounded-full border-2 border-white ${s.event_type==="check_out"?"bg-blue-500":"bg-emerald-500"}`}),e.jsxs("div",{className:"bg-card/40 rounded-xl p-4 ring-1 ring-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold ${s.event_type==="check_out"?"bg-blue-100 text-blue-700":"bg-emerald-100 text-emerald-700"}`,children:s.event_type==="check_out"?"Check Out":"Return"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.event_timestamp).toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.assigned_to&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Person"}),e.jsx("p",{className:"text-white font-medium",children:s.assigned_to})]}),s.site&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Site"}),e.jsx("p",{className:"text-white",children:s.site})]}),s.job_reference&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Job Ref"}),e.jsx("p",{className:"text-white font-mono text-xs",children:s.job_reference})]}),s.expected_return_date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Expected Return"}),e.jsx("p",{className:"text-white",children:new Date(s.expected_return_date).toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"})})]})]}),s.notes&&e.jsx("p",{className:"text-sm text-foreground/85 mt-2 pt-2 border-t border-border/70",children:s.notes}),(s.pickup_photo_url||s.return_photo_url)&&e.jsxs("div",{className:"flex gap-2 mt-2 pt-2 border-t border-border/70",children:[s.pickup_photo_url&&e.jsx("a",{href:s.pickup_photo_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:"Pickup Photo"}),s.return_photo_url&&e.jsx("a",{href:s.return_photo_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:"Return Photo"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-2",children:["Recorded by: ",s.created_by||"System"]})]})]},s.id))})]})})]})})]})]})]})}export{R as default};
