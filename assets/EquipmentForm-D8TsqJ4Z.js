import{r as i,j as e,U as l}from"./index-hE1nDyln.js";import{u as v,C as N}from"./Index-Dk0B5qU_.js";import"./supabase-DllM73rC.js";import"./Settings-DPtOlVMX.js";const w=["New","Good","Fair","Poor","Damaged"];function T({equipment:a,onClose:u,onSuccess:m}){const{createEquipment:f,updateEquipment:h}=v(),[x,g]=i.useState(!1),[n,_]=i.useState({}),[b,c]=i.useState(null),d=!!a,[s,o]=i.useState({asset_id:"",name:"",category:"General",condition:"Good",notes:"",test_tag_done_date:"",test_tag_next_due:"",tag_threshold_days:30});i.useEffect(()=>{a&&o({asset_id:a.asset_id,name:a.name,category:a.category,condition:a.condition,notes:a.notes||"",test_tag_done_date:a.test_tag_done_date||"",test_tag_next_due:a.test_tag_next_due_date||a.test_tag_next_due||"",tag_threshold_days:a.tag_threshold_days??30})},[a]);const y=()=>{const t={};return s.asset_id.trim()||(t.asset_id="Asset ID is required"),s.name.trim()||(t.name="Name is required"),s.category||(t.category="Category is required"),_(t),Object.keys(t).length===0},j=async t=>{if(t.preventDefault(),c(null),!!y()){g(!0);try{if(d&&a){const r={asset_id:s.asset_id,name:s.name,category:s.category,condition:s.condition,test_tag_done_date:s.test_tag_done_date||null,test_tag_next_due_date:s.test_tag_next_due||null};await h(a.id,r)?m():c("Update failed. Check console/network and try again.")}else{const r=`QR-${s.asset_id}`,p={asset_id:s.asset_id,name:s.name,category:s.category,condition:s.condition,qr_code:r,test_tag_done_date:s.test_tag_done_date||null,test_tag_next_due_date:s.test_tag_next_due||null,current_status:"Available"};await f(p)?m():c("Create failed. Check console/network and try again.")}}catch(r){console.error("Equipment form error:",r),c((r==null?void 0:r.message)||"Unexpected error creating/updating equipment.")}finally{g(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${l.card} w-full max-w-lg max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${l.divider} flex items-center justify-between`,children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:d?"Edit Equipment":"Add New Equipment"}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[b&&e.jsx("div",{className:"llt-alert llt-alert--danger llt-body-sm px-4 py-3",children:b}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Asset ID ",e.jsx("span",{className:"llt-error-text",children:"*"})]}),e.jsx("input",{type:"text",value:s.asset_id,onChange:t=>o(r=>({...r,asset_id:t.target.value})),placeholder:"e.g., TT-0025",disabled:d,className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border- ${n.asset_id?"border-destructive/40 bg-destructive/10":"border-border/70"} ${d?"bg-background/60 text-muted-foreground":""}`}),n.asset_id&&e.jsx("p",{className:"text-xs llt-error-text mt-1",children:n.asset_id})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Category ",e.jsx("span",{className:"llt-error-text",children:"*"})]}),e.jsx("select",{value:s.category,onChange:t=>o(r=>({...r,category:t.target.value})),className:`w-full px-3 py-2.5 rounded-lg text-sm focus:outline-none border ${l.input}`,children:N.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:["Equipment Name ",e.jsx("span",{className:"llt-error-text",children:"*"})]}),e.jsx("input",{type:"text",value:s.name,onChange:t=>o(r=>({...r,name:t.target.value})),placeholder:"e.g., Hilti TE 70-ATC Rotary Hammer",className:`w-full px-3 py-2.5 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border- ${n.name?"border-destructive/40 bg-destructive/10":"border-border/70"}`}),n.name&&e.jsx("p",{className:"text-xs llt-error-text mt-1",children:n.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Condition"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:w.map(t=>e.jsx("button",{type:"button",onClick:()=>o(r=>({...r,condition:t})),className:`px-3 py-1.5 rounded-lg text-xs font-medium border transition-all ${s.condition===t?"bg-primary/15 text-primary ring-1 ring-amber-400/20 border-transparent":"border-border/70 text-foreground/85 hover:border-white/20"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Notes (local only for now)"}),e.jsx("textarea",{value:s.notes,onChange:t=>o(r=>({...r,notes:t.target.value})),rows:2,placeholder:"Equipment description or notes...",className:"w-full px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border- resize-none"})]}),e.jsxs("div",{className:`border-t ${l.divider} pt-4`,children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Test & Tag Compliance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Last Test Date"}),e.jsx("input",{type:"date",value:s.test_tag_done_date,onChange:t=>o(r=>({...r,test_tag_done_date:t.target.value})),className:`w-full px-3 py-2.5 rounded-lg text-sm focus:outline-none border ${l.input}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Next Due Date"}),e.jsx("input",{type:"date",value:s.test_tag_next_due,onChange:t=>o(r=>({...r,test_tag_next_due:t.target.value})),className:`w-full px-3 py-2.5 rounded-lg text-sm focus:outline-none border ${l.input}`})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-1",children:"Due Soon Threshold (days) (local only for now)"}),e.jsx("input",{type:"number",value:s.tag_threshold_days,onChange:t=>o(r=>({...r,tag_threshold_days:parseInt(t.target.value)||30})),min:1,max:365,className:"w-32 px-3 py-2.5 border border-border/70 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-/20 focus:border-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 px-4 py-2.5 border border-border/70 rounded-lg text-sm font-medium text-foreground/90 hover:bg-background/60 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"flex-1 px-4 py-2.5 bg-primary text-primary-foreground rounded-lg text-sm font-semibold hover:bg-primary transition-colors disabled:opacity-50",children:x?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Saving..."]}):d?"Update Equipment":"Create Equipment"})]})]})]})})}export{T as default};
