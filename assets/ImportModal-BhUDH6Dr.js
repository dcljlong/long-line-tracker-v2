import{r as c,j as e,U as k}from"./index-Dp5AHC-w.js";import{u as R}from"./Index-CPKsa3qD.js";import"./supabase-DllM73rC.js";import"./Settings-DoPy-T8b.js";function z({onClose:u,onSuccess:w}){const{createEquipment:_,equipment:C}=R(),g=c.useRef(null),[l,x]=c.useState("upload"),[m,j]=c.useState([]),[b,L]=c.useState(0),[p,M]=c.useState({success:0,failed:0}),I=new Set(C.map(t=>t.asset_id.toLowerCase())),q=t=>{const n=t.trim().split(`
`);if(n.length<2)return[];const d=n[0].split(",").map(r=>r.trim().toLowerCase().replace(/['"]/g,""));return n.slice(1).map(r=>{const o=r.split(",").map(f=>f.trim().replace(/^["']|["']$/g,"")),s={};d.forEach((f,B)=>{s[f]=o[B]||""});const a=[],i=s.asset_id||s["asset id"]||s.id||"",N=s.name||s["equipment name"]||s.equipment||"";i||a.push("Missing Asset ID"),N||a.push("Missing Name");const y=I.has(i.toLowerCase());return y&&a.push("Duplicate Asset ID"),{asset_id:i,name:N,category:s.category||s.type||"General",condition:s.condition||"Good",notes:s.notes||s.description||"",test_tag_done_date:s.test_tag_done_date||s.last_test||s["last test"]||"",test_tag_next_due:s.test_tag_next_due||s.next_test||s["next test"]||"",qr_code:s.qr_code||s.qr||"",isValid:a.length===0,errors:a,isDuplicate:y}})},S=t=>{var r;const n=(r=t.target.files)==null?void 0:r[0];if(!n)return;const d=new FileReader;d.onload=o=>{var i;const s=(i=o.target)==null?void 0:i.result,a=q(s);j(a),x("preview")},d.readAsText(n)},V=async()=>{const t=m.filter(r=>r.isValid);if(t.length===0)return;x("importing");let n=0,d=0;for(let r=0;r<t.length;r++){const o=t[r];try{await _({asset_id:o.asset_id,qr_code:o.qr_code||`QR-${o.asset_id}`,name:o.name,category:o.category,condition:o.condition,notes:o.notes,test_tag_done_date:o.test_tag_done_date||null,test_tag_next_due:o.test_tag_next_due||null,current_status:"Available",tag_threshold_days:30})?n++:d++}catch{d++}L((r+1)/t.length*100)}M({success:n,failed:d}),x("done")},h=m.filter(t=>t.isValid).length,v=m.filter(t=>!t.isValid).length;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${k.card} w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${k.divider} flex items-center justify-between`,children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Import Equipment"}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[l==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{onClick:()=>{var t;return(t=g.current)==null?void 0:t.click()},className:"border-2 border-dashed border-white/20 rounded-xl p-12 text-center cursor-pointer hover:border- hover:bg-blue-50/30 transition-all",children:[e.jsx("svg",{className:"w-12 h-12 text-white/20 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),e.jsx("p",{className:"text-sm font-medium text-foreground/90 mb-1",children:"Click to upload CSV file"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supports .csv files"})]}),e.jsx("input",{ref:g,type:"file",accept:".csv,.txt",onChange:S,className:"hidden"}),e.jsxs("div",{className:"bg-background/60 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Expected CSV Format"}),e.jsxs("code",{className:"text-xs text-foreground/85 block bg-background/60 p-3 rounded border border-border/70 font-mono",children:["asset_id,name,category,condition,notes,test_tag_done_date,test_tag_next_due",e.jsx("br",{}),"TT-0025,Makita Drill,Power Tools,Good,Heavy duty,2026-01-15,2026-07-15"]})]})]}),l==="preview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),h," valid"]}),v>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-50 text-red-700 rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),v," invalid"]})]}),e.jsx("div",{className:"border border-border/70 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-64",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-background/60 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-muted-foreground",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-muted-foreground",children:"Asset ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-muted-foreground",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-muted-foreground",children:"Category"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-muted-foreground",children:"Issues"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:m.map((t,n)=>e.jsxs("tr",{className:t.isValid?"":"bg-red-50/50",children:[e.jsx("td",{className:"px-3 py-2",children:t.isValid?e.jsx("span",{className:"w-5 h-5 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}):e.jsx("span",{className:"w-5 h-5 rounded-full bg-red-100 text-red-600 flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}),e.jsx("td",{className:"px-3 py-2 font-mono text-xs",children:t.asset_id||"-"}),e.jsx("td",{className:"px-3 py-2",children:t.name||"-"}),e.jsx("td",{className:"px-3 py-2 text-muted-foreground",children:t.category}),e.jsx("td",{className:"px-3 py-2 text-xs text-red-500",children:t.errors.join(", ")})]},n))})]})})})]}),l==="importing"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("svg",{className:"animate-spin w-12 h-12 text- mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-sm font-medium text-white mb-2",children:"Importing equipment..."}),e.jsx("div",{className:"w-64 mx-auto h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg- rounded-full transition-all",style:{width:`${b}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[Math.round(b),"%"]})]}),l==="done"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-lg font-bold text-white mb-1",children:"Import Complete"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[p.success," imported successfully",p.failed>0&&`, ${p.failed} failed`]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border/70 flex items-center justify-end gap-3",children:[l==="upload"&&e.jsx("button",{onClick:u,className:"px-4 py-2.5 border border-border/70 rounded-lg text-sm font-medium text-foreground/90 hover:bg-background/60",children:"Cancel"}),l==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{x("upload"),j([])},className:"px-4 py-2.5 border border-border/70 rounded-lg text-sm font-medium text-foreground/90 hover:bg-background/60",children:"Back"}),e.jsxs("button",{onClick:V,disabled:h===0,className:"px-4 py-2.5 bg-primary text-primary-foreground rounded-lg text-sm font-semibold hover:bg-primary disabled:opacity-50",children:["Import ",h," Items"]})]}),l==="done"&&e.jsx("button",{onClick:()=>{w(),u()},className:"px-4 py-2.5 bg-primary text-primary-foreground rounded-lg text-sm font-semibold hover:bg-primary",children:"Done"})]})]})})}export{z as default};
